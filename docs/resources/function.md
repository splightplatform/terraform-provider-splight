---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "splight_function Resource - terraform-provider-splight"
subcategory: ""
description: |-
  
---

# splight_function (Resource)



## Example Usage

```terraform
terraform {
  required_providers {
    splight = {
      source = "splightplatform/splight"
    }
  }
}

# Create a tag
resource "splight_tag" "my_tag" {
  name = "My Tag"
}

# Fetch tags
data "splight_tags" "my_tags" {}

resource "splight_asset" "my_asset" {
  name        = "My Asset"
  description = "My Asset Description"
  timezone    = "America/Los_Angeles"

  geometry = jsonencode({
    type = "GeometryCollection"
    geometries = [
      {
        type        = "Point"
        coordinates = [0, 0]
      }
    ]
  })
}

resource "splight_asset_attribute" "my_attribute" {
  name  = "My Attribute"
  type  = "Number"
  asset = splight_asset.my_asset.id
}

resource "splight_asset" "my_target_asset" {
  name        = "My Target Asset"
  description = "My Target Asset Description"
  timezone    = "America/Los_Angeles"

  geometry = jsonencode({
    type = "GeometryCollection"
    geometries = [
      {
        type        = "Point"
        coordinates = [0, 0]
      }
    ]
  })
}

resource "splight_asset_attribute" "my_target_attribute" {
  name  = "My Target Attribute"
  type  = "Number"
  asset = splight_asset.my_target_asset.id
}

resource "splight_function" "FunctionTest" {
  name            = "My Function"
  description     = "My Function Description"
  type            = "rate"
  rate_unit       = "minute"
  rate_value      = 10
  time_window     = 3600
  target_variable = "B"

  target_asset {
    id   = splight_asset.my_target_asset.id
    name = splight_asset.my_target_asset.name
  }

  target_attribute {
    id   = splight_asset_attribute.my_target_attribute.id
    name = splight_asset_attribute.my_target_attribute.name
    type = "Number"
  }

  # Use an existing tag in the platform
  dynamic "tags" {
    for_each = { for tag in data.splight_tags.my_tags.tags : tag.name => tag if tag.name == "Existing Tag" }

    content {
      name = tags.value.name
      id   = tags.value.id
    }
  }

  # Or use the one created
  tags {
    name = splight_tag.my_tag.name
    id   = splight_tag.my_tag.id
  }

  function_items {
    ref_id           = "A"
    type             = "QUERY"
    expression       = ""
    expression_plain = ""

    query_filter_asset {
      id   = splight_asset.my_asset.id
      name = splight_asset.my_asset.name
    }

    query_filter_attribute {
      id   = splight_asset_attribute.my_attribute.id
      name = splight_asset_attribute.my_attribute.name
      type = "Number"
    }

    query_group_function = "avg"
    query_group_unit     = "day"

    query_plain = jsonencode([
      {
        "$match" = {
          asset     = splight_asset.my_asset.id
          attribute = splight_asset_attribute.my_attribute.id
        }
      }
    ])

  }

  function_items {
    ref_id     = "B"
    type       = "EXPRESSION"
    expression = "A * 2"
    expression_plain = jsonencode({
      "$function" : {
        "body" : "function () { return A * 2 }",
        "args" : [],
        "lang" : "js"
      }
    })

    query_filter_asset {}

    query_filter_attribute {}

    query_group_function = ""
    query_group_unit     = ""

    query_plain = ""
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `description` (String) The description of the resource
- `function_items` (Block List, Min: 1) traces to be used to compute the results (see [below for nested schema](#nestedblock--function_items))
- `name` (String) The name of the resource
- `target_asset` (Block Set, Min: 1, Max: 1) Asset filter (see [below for nested schema](#nestedblock--target_asset))
- `target_attribute` (Block Set, Min: 1, Max: 1) Attribute filter (see [below for nested schema](#nestedblock--target_attribute))
- `target_variable` (String) variable to be considered to be ingested
- `time_window` (Number) window to fetch data from. Data out of that window will not be considered for evaluation
- `type` (String) [cron|rate] type for the cron

### Optional

- `cron_dom` (Number) schedule value for cron
- `cron_dow` (Number) schedule value for cron
- `cron_hours` (Number) schedule value for cron
- `cron_minutes` (Number) schedule value for cron
- `cron_month` (Number) schedule value for cron
- `cron_year` (Number) schedule value for cron
- `rate_unit` (String) [day|hour|minute] schedule unit
- `rate_value` (Number) schedule value
- `tags` (Block Set) tags of the resource (see [below for nested schema](#nestedblock--tags))

### Read-Only

- `id` (String) The ID of this resource.

<a id="nestedblock--function_items"></a>
### Nested Schema for `function_items`

Required:

- `expression` (String) how the expression is shown (i.e 'A * 2')
- `expression_plain` (String) actual mongo query containing the expression
- `query_filter_asset` (Block Set, Min: 1, Max: 1) Asset filter (see [below for nested schema](#nestedblock--function_items--query_filter_asset))
- `query_filter_attribute` (Block Set, Min: 1, Max: 1) Attribute filter (see [below for nested schema](#nestedblock--function_items--query_filter_attribute))
- `query_group_function` (String) function used to aggregate data
- `query_group_unit` (String) time window to apply the aggregation
- `query_plain` (String) actual mongo query
- `ref_id` (String) identifier of the variable (i.e 'A')
- `type` (String) either QUERY or EXPRESSION

Read-Only:

- `id` (String) Id of the function item

<a id="nestedblock--function_items--query_filter_asset"></a>
### Nested Schema for `function_items.query_filter_asset`

Optional:

- `id` (String) Id of the resource
- `name` (String) name of the resource


<a id="nestedblock--function_items--query_filter_attribute"></a>
### Nested Schema for `function_items.query_filter_attribute`

Optional:

- `id` (String) Id of the resource
- `name` (String) name of the resource
- `type` (String) type of the resource



<a id="nestedblock--target_asset"></a>
### Nested Schema for `target_asset`

Optional:

- `id` (String) Id of the resource
- `name` (String) name of the resource


<a id="nestedblock--target_attribute"></a>
### Nested Schema for `target_attribute`

Optional:

- `id` (String) Id of the resource
- `name` (String) name of the resource
- `type` (String) type of the resource


<a id="nestedblock--tags"></a>
### Nested Schema for `tags`

Required:

- `id` (String) tag id
- `name` (String) tag name

## Import

Import is supported using the following syntax:

The [`terraform import` command](https://developer.hashicorp.com/terraform/cli/commands/import) can be used, for example:

```shell
terraform import [options] splight_function.<name> <function_id>
```
